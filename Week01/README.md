## 学习笔记

### 微服务

#### 单体应用架构
单体应用开发简单，但随着业务复杂度的提升，单体应用的弊端逐渐显现，开发效率和系统应用的可扩展性，可靠性等方面出现严重问题。

#### 微服务架构
相比传统的单体应用架构，微服务架构具有服务高度自治、高效迭代、易于扩展和支持多语言编程等优点。
总体来说，微服务架构有如下的特点：
- 微服务遵循单一原则，每个微服务负责一个独立上下文边界；
- 微服务架构提供的服务之间采用轻量协议传输，相比 ESB 更轻量；
- 每个服务都有自己独立的业务开发活动和周期；
- 微服务一般使用容器技术独立部署，运行在自己的独立进程中，合理分配其所需的系统资源，这样开发者就可以更加方便地制定每个服务的优化方案，提高系统可维护性。

#### 微服务的不足
- 分布式带来的复杂性
- 测试
- 服务间的依赖
- 对运维基础设施的挑战

### 微服务实践
- 组件服务化
- 按业务组织服务
- 去中心化
- 基础设施自动化
- 可用性和兼容性设计
- API Gateway
- 微服务划分
- 微服务安全

### gRPC
- 多语言:语言中立，支持多种语言。
- 轻量级、高性能:序列化支持 PB(Protocol Buffer)和 JSON，PB 是一种语言无关的高性能序列化框架。
- 可插拔
- IDL:基于文件定义服务，通过proto3工具生成指定语言的数据结构、服务端接口以及客户端Stub。
- 设计理念
- 移动端:基于标准的HTTP2设计，支持双向流、消息头压缩、单TCP的多路复用、服务端推送等特性，这些特性使得gRPC在移动端设备上更加省电和节省网络流量。
- 服务而非对象、消息而非引用:促进微服务的系统间粗粒度消息交互设计理念。
- 负载无关的:不同的服务需要使用不同的消息类型和编码，例如protocol buffers、JSON、XML和Thrift。
- 流:Streaming API。
- 阻塞式和非阻塞式:支持异步和同步处理在客户端和服务端间交互的消息序列。
- 元数据交换:常见的横切关注点，如认证或跟踪，依赖数据交换。
- 标准化状态码:客户端通常以有限的方式响应API调用返回的错误。

#### gRPC-HealthCheck
gRPC有一个标准的健康检测协议，在gRPC的所有语言实现中基本都提供了生成代码和用于设置运行状态的功能。

#### 服务发现
- 客户端发现
一个服务实例被启动时，它的网络地址会被写到注册表上;
当服务实例终止时，再从注册表中删除;
这个服务实例的注册表通过心跳机制动态刷新;
客户端使用一个负载均衡算法，去选择一个可用的服务实例，来响应这个请求。
直连，比服务端服务发现少一次网络跳转， Consumer需要内置特定的服务发现客户端和发现逻辑。
- 服务端发现
客户端通过负载均衡器向一个服务发送请求，这个负载均衡器会查询服务注册表，并将请求路由到可用的服务实例上。
服务实例在服务注册表上被注册和注销(Consul Template+Nginx， kubernetes+etcd)。
Consumer无需关注服务发现具体细节，只需知道服务的DNS域名即可，支持异构语言开发，
需要基础设施支撑，多了一次网络跳转，可能有性能损失。


